<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Off-net Calling with BGCF and IBCF &mdash; Project Clearwater 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Project Clearwater 1.0 documentation" href="index.html" />
    <link rel="next" title="Multiple Domains" href="Multiple_Domains.html" />
    <link rel="prev" title="Privacy" href="Clearwater_Privacy_Feature.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="off-net-calling-with-bgcf-and-ibcf">
<h1>Off-net Calling with BGCF and IBCF<a class="headerlink" href="#off-net-calling-with-bgcf-and-ibcf" title="Permalink to this headline">¶</a></h1>
<p>The Clearwater IBCF (Interconnection Border Control Function) provides
an interface point between a Clearwater deployment and one or more
trusted SIP trunks.</p>
<p>The IBCF does not currently provide all of the functions of an IMS
compliant IBCF - in particular it does not support topology hiding or an
H.248 interface to control a Transition Gateway.</p>
<p>To use the IBCF function you must install and configure at least one
IBCF node, set up the ENUM configuration appropriately, and set up BGCF
(Breakout Gateway Control Function) routing configuration on the Sprout
nodes.</p>
<div class="section" id="install-and-configure-an-ibcf">
<h2>Install and Configure an IBCF<a class="headerlink" href="#install-and-configure-an-ibcf" title="Permalink to this headline">¶</a></h2>
<p>Install and configure an IBCF node with the following steps.</p>
<ul>
<li><p class="first">Install the node as if installing a Bono node, either
<a class="reference external" href="Manual_Install.md">manually</a> or <a class="reference external" href="Automated_Install.md">using
Chef</a>. If using Chef, use the <code class="docutils literal"><span class="pre">ibcf</span></code> role,
for example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>knife box create -E &lt;name&gt; ibcf
</pre></div>
</div>
</li>
<li><p class="first">Edit the /etc/clearwater/user_settings file (creating it if it does
not already exist) and add or update the line defining the IP
addresses of SIP trunk peer nodes.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">trusted_peers</span><span class="o">=</span><span class="s2">&quot;&lt;trunk 1 IP address&gt;,&lt;trunk 2 IP address&gt;,&lt;trunk 3 IP address&gt;, ...&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart the Bono daemon.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>service stop bono (allow monit to restart Bono)
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="enum-configuration">
<h2>ENUM Configuration<a class="headerlink" href="#enum-configuration" title="Permalink to this headline">¶</a></h2>
<p>The number ranges that should be routed over the SIP trunk must be set
up in the ENUM configuration to map to a SIP URI owned by the SIP trunk
provider, and routable to that provider. For example, you would normally
want to map a dialed number to a URI of the form <code class="docutils literal"><span class="pre">&lt;number&gt;&#64;&lt;domain&gt;</span></code>.</p>
<p>This can either be achieved by defining rules for each number range you
want to route over the trunk, for example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>*.0.1.5 IN NAPTR 1 1 &quot;u&quot; &quot;E2U+sip&quot; &quot;!(^.*$)!sip:\\1@&lt;trunk IP address&gt;!&quot; .
*.0.1.5.1 IN NAPTR 1 1 &quot;u&quot; &quot;E2U+sip&quot; &quot;!(^.*$)!sip:\\1@&lt;trunk IP address&gt;!&quot; .
</pre></div>
</div>
<p>or by defining a default mapping to the trunk and exceptions for number
ranges you want to keep on-net, for example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>* IN NAPTR 1 1 &quot;u&quot; &quot;E2U+sip&quot; &quot;!(^.*$)!sip:\\1@&lt;trunk IP address&gt;!&quot; .
*.3.2.1.2.4.2 IN NAPTR 1 1 &quot;u&quot; &quot;E2U+sip&quot; &quot;!(^.*$)!sip:\\1@&lt;local domain&gt;!&quot; .
*.3.2.1.2.4.2.1 IN NAPTR 1 1 &quot;u&quot; &quot;E2U+sip&quot; &quot;!(^.*$)!sip:\\1@&lt;local domain&gt;!&quot; .
</pre></div>
</div>
<p>You can also use ENUM to provide number portability information, for
example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>*.3.2.1.2.4.2 IN NAPTR 1 1 &quot;u&quot; &quot;E2U+pstn:tel&quot; &quot;!(^.*$)!sip:\\1;npdi;rn=+242123@&lt;local domain&gt;!&quot; .
*.3.2.1.2.4.2.1 IN NAPTR 1 1 &quot;u&quot; &quot;E2U+pstn:tel&quot; &quot;!(^.*$)!sip:\\1;npdi@&lt;local domain&gt;!&quot; .
</pre></div>
</div>
<p>Refer to the <a class="reference external" href="ENUM.md">ENUM guide</a> for more about how to configure
ENUM.</p>
</div>
<div class="section" id="bgcf-configuration">
<h2>BGCF Configuration<a class="headerlink" href="#bgcf-configuration" title="Permalink to this headline">¶</a></h2>
<p>BGCF (Border Gateway Control Function) configuration is stored in the
<code class="docutils literal"><span class="pre">bgcf.json</span></code> file in <code class="docutils literal"><span class="pre">/etc/clearwater</span></code> on each sprout node (both I-
and S-CSCF). The file stores two types of mappings. This first maps from
SIP trunk IP addresses and/or host names to IBCF host names, and the
second maps from a routing number (using prefix matching) to IBCF host
names. These mappings control which IBCF nodes are used to route to a
particular destination. Each entry can only apply to one type of
mapping.</p>
<p>Multiple nodes to route to can be specified. In this case, Route headers
are added to the message such that it is sent to the first node and the
first node sends it to the second node and so on; the message is not
tried at the second node if it fails at the first node.</p>
<p>The file is in JSON format, for example.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;routes&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>   <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;route 1 descriptive name&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;domain&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;SIP trunk IP address or host name&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;route&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;IBCF SIP URI&gt;&quot;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>   <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;route 2 descriptive name&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;domain&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;SIP trunk IP address or host name&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;route&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;IBCF SIP URI&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;IBCF SIP URI&gt;&quot;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>   <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;route 3 descriptive name&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;number&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;Routing number&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;route&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;IBCF SIP URI&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;IBCF SIP URI&gt;&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There can be only one route set for any given SIP trunk IP address or
host name. If there are multiple routes with the same destination IP
address or host name, only the first will be used. Likewise, there can
only be one route set for any given routing number; if there are
multiple routes with the same routing number only the first will be
used.</p>
<p>A default route set can be configured by having an entry where the
domain is set to <code class="docutils literal"><span class="pre">&quot;*&quot;</span></code>. This will be used by the BGCF if it is trying
to route based on the the domain and there&#8217;s no explicit match for the
domain in the configuration.</p>
<p>There is no default route set if the BGCF is routing based on the
routing number provided.</p>
<p>After making a change to this file you should run
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">/usr/share/clearwater/clearwater-config-manager/scripts/upload_bgcf_json</span></code>
to ensure the change is synchronized to other Sprout nodes on your
system (including nodes added in the future).</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Off-net Calling with BGCF and IBCF</a><ul>
<li><a class="reference internal" href="#install-and-configure-an-ibcf">Install and Configure an IBCF</a></li>
<li><a class="reference internal" href="#enum-configuration">ENUM Configuration</a></li>
<li><a class="reference internal" href="#bgcf-configuration">BGCF Configuration</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Clearwater_Privacy_Feature.html" title="previous chapter">Privacy</a></li>
      <li>Next: <a href="Multiple_Domains.html" title="next chapter">Multiple Domains</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/IBCF.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Metaswitch Networks.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="_sources/IBCF.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>