<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating a Chef deployment environment &mdash; Project Clearwater 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Project Clearwater 1.0 documentation" href="index.html" />
    <link rel="next" title="Creating a deployment with Chef" href="Creating_a_deployment_with_Chef.html" />
    <link rel="prev" title="Installing a Chef Client" href="Installing_a_Chef_workstation.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="creating-a-chef-deployment-environment">
<h1>Creating a Chef deployment environment<a class="headerlink" href="#creating-a-chef-deployment-environment" title="Permalink to this headline">¶</a></h1>
<p>These instructions make up part of the <a class="reference external" href="Automated_Install.md">automated install
process</a> for Clearwater. They will take you
through creating a deployment environment, which will be used to define
the specific settings for a Clearwater deployment.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>You must have <a class="reference external" href="Installing_a_Chef_workstation.md">installed a Chef
workstation</a>.</li>
<li>You must have SSH access to the ubuntu user on the chef workstation
machine.</li>
</ul>
</div>
<div class="section" id="creating-a-keypair">
<h2>Creating a keypair<a class="headerlink" href="#creating-a-keypair" title="Permalink to this headline">¶</a></h2>
<p>You need to configure the AWS keypair used to access your Clearwater
deployment. You may reuse the one you created when creating your Chef
client and server; or you may create a new one (EC2 Dashboard &gt; Network
&amp; Security &gt; Key Pairs &gt; Create Key Pair) for finer-grained access
rights. The name you give your keypair will be referred to as
<code class="docutils literal"><span class="pre">&lt;keypair_name&gt;</span></code> from this point.</p>
<p>Amazon will give you a <code class="docutils literal"><span class="pre">&lt;keypair_name&gt;</span></code>.pem file; copy that file to
the <code class="docutils literal"><span class="pre">/home/ubuntu/.chef/</span></code> directory on your Chef client, and make it
readable only to your user with
<code class="docutils literal"><span class="pre">chmod</span> <span class="pre">0700</span> <span class="pre">/home/ubuntu/.chef</span> <span class="pre">;</span> <span class="pre">chmod</span> <span class="pre">0400</span> <span class="pre">/home/ubuntu/.chef/&lt;keypair_name&gt;.pem</span></code>.</p>
</div>
<div class="section" id="creating-the-environment">
<h2>Creating the environment<a class="headerlink" href="#creating-the-environment" title="Permalink to this headline">¶</a></h2>
<p>Before creating an environment, choose a name (e.g. &#8220;clearwater&#8221;) which
will be referred to as <code class="docutils literal"><span class="pre">&lt;name&gt;</span></code> in the following steps. Now, on the
chef workstation machine, create a file in
<code class="docutils literal"><span class="pre">~/chef/environments/&lt;name&gt;.rb</span></code> with the following contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>name &quot;&lt;name&gt;&quot;
description &quot;Clearwater deployment - &lt;name&gt;&quot;
cookbook_versions &quot;clearwater&quot; =&gt; &quot;= 0.1.0&quot;
override_attributes &quot;clearwater&quot; =&gt; {
  &quot;root_domain&quot; =&gt; &quot;&lt;zone&gt;&quot;,
  &quot;availability_zones&quot; =&gt; [&quot;us-east-1a&quot;, &quot;us-east-1b&quot;],
  &quot;repo_server&quot; =&gt; &quot;http://repo.cw-ngv.com/stable&quot;,
  &quot;number_start&quot; =&gt; &quot;6505550000&quot;,
  &quot;number_count&quot; =&gt; 1000,
  &quot;keypair&quot; =&gt; &quot;&lt;keypair_name&gt;&quot;,
  &quot;keypair_dir&quot; =&gt; &quot;~/.chef/&quot;,
  &quot;pstn_number_count&quot; =&gt; 0,
  &quot;gr&quot; =&gt; false
}
</pre></div>
</div>
<p>Note that the value of <code class="docutils literal"><span class="pre">keypair</span></code> should <em>not</em> include the trailing
.pem. Note also that for an all-in-one node the root-domain parameter is
superfluous and will be ignored.</p>
<p>By default, your deployment will be created in the US East (North
Virginia) region. However, if you want to deploy in another region, you
must</p>
<ul class="simple">
<li>set the <code class="docutils literal"><span class="pre">region</span></code> property in the
<code class="docutils literal"><span class="pre">override_attributes</span> <span class="pre">&quot;clearwater&quot;</span></code> block (e.g. to <code class="docutils literal"><span class="pre">us-west-2</span></code>)</li>
<li>set the <code class="docutils literal"><span class="pre">availability_zones</span></code> property correspondingly (e.g.
<code class="docutils literal"><span class="pre">[&quot;us-west-2a&quot;,</span> <span class="pre">&quot;us-west-2b&quot;]</span></code>)</li>
<li>open <code class="docutils literal"><span class="pre">~/chef/plugins/knife/boxes.rb</span></code>, search for
<code class="docutils literal"><span class="pre">&#64;&#64;default_image</span></code>, and comment in the EC2 AMI entry for the region
you desire.</li>
</ul>
<p>These fields override attributes defined and documented in the
<a class="reference external" href="https://github.com/Metaswitch/chef/blob/master/roles/clearwater-infrastructure.rb">clearwater-infrastructure
role</a>.</p>
<p>If you want to use a different SIP registration period from the default
(which is 5 minutes) add a line like
<code class="docutils literal"><span class="pre">&quot;reg_max_expires&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&lt;timeout_in_secs&gt;,</span></code> to the
<code class="docutils literal"><span class="pre">override_attributes</span> <span class="pre">&quot;clearwater&quot;</span></code> block.</p>
<p>If you want to test <a class="reference external" href="Geographic_redundancy.md">geographic redundancy
function</a>, use <code class="docutils literal"><span class="pre">&quot;gr&quot;</span> <span class="pre">=&gt;</span> <span class="pre">true</span></code> instead of
<code class="docutils literal"><span class="pre">&quot;gr&quot;</span> <span class="pre">=&gt;</span> <span class="pre">false</span></code>. This will cause odd-numbered and even-numbered nodes
to be treated as separate logical &#8220;sites&#8221; - they are not actually in
different EC2 regions (cross-region security group rules make that
difficult), but does allow you to see and test GR function.</p>
<p>To modify these settings after the deployment is created, follow <a class="reference external" href="Modifying_Clearwater_settings.md">these
instructions</a>.</p>
</div>
<div class="section" id="uploading-the-environment">
<h2>Uploading the environment<a class="headerlink" href="#uploading-the-environment" title="Permalink to this headline">¶</a></h2>
<p>The newly created environment needs to be uploaded to the Chef server
before it can be used.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd ~/chef
knife environment from file environments/&lt;name&gt;.rb
</pre></div>
</div>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>At this point, your deployment environment is created and can be used to
<a class="reference external" href="Creating_a_deployment_with_Chef.md">create a new deployment</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Creating a Chef deployment environment</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#creating-a-keypair">Creating a keypair</a></li>
<li><a class="reference internal" href="#creating-the-environment">Creating the environment</a></li>
<li><a class="reference internal" href="#uploading-the-environment">Uploading the environment</a></li>
<li><a class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Installing_a_Chef_workstation.html" title="previous chapter">Installing a Chef Client</a></li>
      <li>Next: <a href="Creating_a_deployment_with_Chef.html" title="next chapter">Creating a deployment with Chef</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Creating_a_deployment_environment.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Metaswitch Networks.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="_sources/Creating_a_deployment_environment.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>