<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SNMP Statistics &mdash; Project Clearwater 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Project Clearwater 1.0 documentation" href="index.html" />
    <link rel="next" title="SNMP Alarms" href="SNMP_Alarms.html" />
    <link rel="prev" title="Voxbone" href="Voxbone.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="snmp-statistics">
<h1>SNMP Statistics<a class="headerlink" href="#snmp-statistics" title="Permalink to this headline">¶</a></h1>
<p>Clearwater provides a set of statistics about the performance of each
Clearwater nodes over SNMP. Currently, this is available on Bono,
Sprout, Ralf and Homestead nodes, and the MMTel, Call Diversion, Memento
and Gemini Application Server nodes.</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>These SNMP statistics require:</p>
<ul class="simple">
<li>the clearwater-snmpd package to be installed for all node types</li>
<li>the clearwater-snmp-handler-astaire package to be installed for
Sprout and Ralf nodes</li>
</ul>
<p>These packages will be automatically installed when installing through
the Chef automation system; for a manual install, you will need to
install the packages with <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span></code>.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Clearwater nodes provide SNMP statistics over port 161 using SNMP v2c
and community <code class="docutils literal"><span class="pre">clearwater</span></code>. The MIB definition file can be downloaded
from
<a class="reference external" href="https://github.com/Metaswitch/clearwater-snmp-handlers/blob/master/PROJECT-CLEARWATER-MIB">here</a>.</p>
<p>Our SNMP statistics are provided through plugins or subagents to the
standard SNMPd packaged with Ubuntu, so querying port 161 (the standard
SNMP port) on a Clearwater node will provide system-level stats like
CPU% as well as any available Clearwater stats.</p>
<p>To load the MIB file, allowing you to refer to MIB objects by name,
first place it in the <code class="docutils literal"><span class="pre">~/.snmp/mibs</span></code> directory. To load the MIB file
for just the current session, run
<code class="docutils literal"><span class="pre">export</span> <span class="pre">MIBS=+PROJECT-CLEARWATER-MIB</span></code>. To load the MIB file every
time, add the line <code class="docutils literal"><span class="pre">mibs</span> <span class="pre">+PROJECT-CLEARWATER-MIB</span></code> to a snmp.conf file
in the <code class="docutils literal"><span class="pre">~/.snmp</span></code> directory.</p>
<p>If a statistic is indexed by time period, then it displays the relevant
statistics over:</p>
<ul class="simple">
<li>the previous five-second period</li>
<li>the current five-minute period</li>
<li>the previous five-minute period</li>
</ul>
<p>For example, a stat queried at 12:01:33 would display the stats
covering:</p>
<ul class="simple">
<li>12:01:25 - 12:01:30 (the previous five-second period)</li>
<li>12:00:00 - 12:01:33 (the current five-minute period)</li>
<li>11:55:00 - 12:00:00 (the previous five-minute period)</li>
</ul>
<p>All latency values are in microseconds.</p>
<div class="line-block">
<div class="line">Many of the statistics listed below are stored in SNMP tables</div>
</div>
<p>(although the MIB file should be examined to determine exactly which
ones). The full table can be retrieved by using the <code class="docutils literal"><span class="pre">snmptable</span></code>
command. For example, the Initial Registrations table for Sprout can be
retrieved by running:
| <code class="docutils literal"><span class="pre">snmptable</span> <span class="pre">-v2c</span> <span class="pre">-c</span> <span class="pre">clearwater</span> <span class="pre">&lt;ip&gt;</span> <span class="pre">PROJECT-CLEARWATER-MIB::sproutInitialRegistrationTable</span></code></p>
<p>The individual table elements can be accessed using:
<code class="docutils literal"><span class="pre">snmpget</span> <span class="pre">-v2c</span> <span class="pre">-c</span> <span class="pre">clearwater</span> <span class="pre">&lt;ip&gt;</span> <span class="pre">&lt;table</span> <span class="pre">OID&gt;.1.&lt;column&gt;.&lt;row&gt;</span></code></p>
<div class="line-block">
<div class="line">For example, the Initial Registration Stats table has an OID of</div>
</div>
<p><code class="docutils literal"><span class="pre">.1.2.826.0.1.1578918.9.3.9</span></code>, so the number of initial registration
attempts in the current five-minute period can be retrieved by:
| <code class="docutils literal"><span class="pre">snmpget</span> <span class="pre">-v2c</span> <span class="pre">-c</span> <span class="pre">clearwater</span> <span class="pre">&lt;ip&gt;</span> <span class="pre">.1.2.826.0.1.1578918.9.3.9.1.2.2</span></code>
or by:
| <code class="docutils literal"><span class="pre">snmpget</span> <span class="pre">-v2c</span> <span class="pre">-c</span> <span class="pre">clearwater</span> <span class="pre">&lt;ip&gt;</span> <span class="pre">PROJECT-CLEARWATER-MIB::sproutInitialRegistrationAttempts.scopeCurrent5MinutePeriod</span></code></p>
<div class="line-block">
<div class="line">The <code class="docutils literal"><span class="pre">snmpwalk</span></code> command can be used to discover the list of queryable</div>
</div>
<p>OIDs beneath a certain point in the MIB tree. For example, you can
retrieve all of the entries in the Sprout Initial Registrations table
using:
| <code class="docutils literal"><span class="pre">snmpwalk</span> <span class="pre">-v2c</span> <span class="pre">-c</span> <span class="pre">clearwater</span> <span class="pre">&lt;ip&gt;</span> <span class="pre">PROJECT-CLEARWATER-MIB::sproutInitialRegistrationTable</span></code></p>
<p>Running
<code class="docutils literal"><span class="pre">snmpwalk</span> <span class="pre">-v2c</span> <span class="pre">-c</span> <span class="pre">clearwater</span> <span class="pre">&lt;ip&gt;</span> <span class="pre">PROJECT-CLEARWATER-MIB::projectClearwater</span></code>
will output a very long list of all available Clearwater stats.</p>
<p>Note that running an &#8216;snmpget&#8217; on a table OID will result in a &#8220;No Such
Object available on this agent at this OID&#8221; message.</p>
<div class="section" id="bono-statistics">
<h3>Bono statistics<a class="headerlink" href="#bono-statistics" title="Permalink to this headline">¶</a></h3>
<p>Bono nodes provide the following statistics:</p>
<ul class="simple">
<li>The standard SNMP CPU and memory usage statistics (see
<a class="reference external" href="http://net-snmp.sourceforge.net/docs/mibs/ucdavis.html">http://net-snmp.sourceforge.net/docs/mibs/ucdavis.html</a> for details)</li>
<li>The average latency, variance, highest latency and lowest latency for
SIP requests, indexed by time period.</li>
<li>The number of parallel TCP connections to each Sprout node.</li>
<li>The number of incoming requests, indexed by time period.</li>
<li>The number of requests rejected due to overload, indexed by time
period.</li>
<li>The average request queue size, variance, highest queue size and
lowest queue size, indexed by time period.</li>
</ul>
</div>
<div class="section" id="sprout-statistics">
<h3>Sprout statistics<a class="headerlink" href="#sprout-statistics" title="Permalink to this headline">¶</a></h3>
<p>Sprout nodes provide the following statistics:</p>
<ul class="simple">
<li>The standard SNMP CPU and memory usage statistics (see
<a class="reference external" href="http://net-snmp.sourceforge.net/docs/mibs/ucdavis.html">http://net-snmp.sourceforge.net/docs/mibs/ucdavis.html</a> for details)</li>
<li>The average latency, variance, highest latency and lowest latency for
SIP requests, indexed by time period.</li>
<li>The average latency, variance, highest latency and lowest latency for
requests to Homestead, indexed by time period.</li>
<li>The average latency, variance, highest latency and lowest latency for
requests to Homestead&#8217;s <code class="docutils literal"><span class="pre">/impi/&lt;private</span> <span class="pre">ID&gt;/av</span></code> endpoint, indexed
by time period.</li>
<li>The average latency, variance, highest latency and lowest latency for
requests to Homestead&#8217;s <code class="docutils literal"><span class="pre">/impi/&lt;private</span> <span class="pre">ID&gt;/registration-status</span></code>
endpoint, indexed by time period.</li>
<li>The average latency, variance, highest latency and lowest latency for
requests to Homestead&#8217;s <code class="docutils literal"><span class="pre">/impu/&lt;public</span> <span class="pre">ID&gt;/reg-data</span></code> endpoint,
indexed by time period.</li>
<li>The average latency, variance, highest latency and lowest latency for
requests to Homestead&#8217;s <code class="docutils literal"><span class="pre">/impu/&lt;public</span> <span class="pre">ID&gt;/location</span></code> endpoint,
indexed by time period.</li>
<li>The average latency, variance, highest latency and lowest latency for
requests to Homer, indexed by time period.</li>
<li>The number of attempts, successes and failures for AKA
authentications on register requests, indexed by time period (AKA
authentication attempts with a correct response but that fail due to
the sequence number in the nonce being out of sync are counted as
successes).</li>
<li>The number of attempts, successes and failures for SIP digest
authentications on register requests, indexed by time period
(authentication attempts with a correct response but that fail due to
being stale are counted as failures).</li>
<li>The number of attempts, successes and failures for authentications on
non-register requests, indexed by time period.</li>
<li>The number of attempts, successes and failures for initial
registrations, indexed by time period (registrations that fail due to
failed authentication are counted in the authentication stats and not
here).</li>
<li>The number of attempts, successes and failures for re-registrations,
indexed by time period (registrations that fail due to failed
authentication are counted in the authentication stats and not here).</li>
<li>The number of attempts, successes and failures for de-registrations,
indexed by time period (registrations that fail due to failed
authentication are counted in the authentication stats and not here).</li>
<li>The number of attempts, successes and failures for third-party
initial registrations, indexed by time period (registrations that
fail due to failed authentication are counted in the authentication
stats and not here).</li>
<li>The number of attempts, successes and failures for third-party
re-registrations, indexed by time period (registrations that fail due
to failed authentication are counted in the authetication stats and
not here).</li>
<li>The number of attempts, successes and failures for third-party
de-registrations, indexed by time period (registrations that fail due
to failed authentication are counted in the authentication stats and
not here).</li>
<li>The number of requests routed by the S-CSCF according to a route
pre-loaded by an app server, indexed by time period.</li>
<li>The number of parallel TCP connections to each Homestead node.</li>
<li>The number of parallel TCP connections to each Homer node.</li>
<li>The number of incoming SIP requests, indexed by time period.</li>
<li>The number of requests rejected due to overload, indexed by time
period.</li>
<li>The average request queue size, variance, highest queue size and
lowest queue size, indexed by time period.</li>
<li>The number of Memcached buckets needing to be synchronized and
buckets already resynchronized during the current Astaire
resynchronization operation (overall, and for each peer).</li>
<li>The number of Memcached entries, and amount of data (in bytes)
already resynchronized during the current Astaire resynchronization
operation.</li>
<li>The transfer rate (in bytes/second) of data during this
resynchronization, over the last 5 seconds (overall, and per bucket).</li>
<li>The number of remaining nodes to query during the current Chronos
scaling operation.</li>
<li>The number of timers, and number of invalid timers, processed over
the last 5 seconds.</li>
<li>The total number of timers being managed by a Chronos node at the
current time.</li>
<li>The weighted average of total timer count, variance, highest timer
count, lowest timer count, indexed by time period.</li>
<li>The number of attempts, successes and failures for incoming SIP
transactions for the ICSCF, indexed by time period and request type.</li>
<li>The number of attempts, successes and failures for outgoing SIP
transactions for the ICSCF, indexed by time period and request type.</li>
<li>The number of attempts, successes and failures for incoming SIP
transactions for the SCSCF, indexed by time period and request type.</li>
<li>The number of attempts, successes and failures for outgoing SIP
transactions for the SCSCF, indexed by time period and request type.</li>
<li>The number of attempts, successes and failures for incoming SIP
transactions for the BGCF, indexed by time period and request type.</li>
<li>The number of attempts, successes and failures for outgoing SIP
transactions for the BGCF, indexed by time period and request type.</li>
<li>The permitted request rate (PRR) is an estimate for the sustainable
request rate without causing large latency. Sprout provides a
weighted average permitted request rate, variance, highest PRR, and
lowest PRR, indexed by time period.</li>
<li>The value of the smoothed latency at the last permitted request rate
update.</li>
<li>The value of the target (maximum permissible) latency at the last
permitted request rate update.</li>
<li>The number of penalties experienced at the last permitted request
rate update.</li>
<li>The current permitted request rate.</li>
<li>The number of incoming INVITE transactions for the S-CSCF that were
cancelled before a 1xx response was seen, indexed by time period.</li>
<li>The number of incoming INVITE transactions for the S-CSCF that were
cancelled after a 1xx response was seen, indexed by time period
(these INVITE cancellation statistics can be used to distinguish
between the case where an INVITE was cancelled because the call rang
but wasn&#8217;t answered and the case where it failed due to network
issues and never got through in the first place).</li>
</ul>
</div>
<div class="section" id="ralf-statistics">
<h3>Ralf statistics<a class="headerlink" href="#ralf-statistics" title="Permalink to this headline">¶</a></h3>
<p>Ralf nodes provide the following statistics:</p>
<ul class="simple">
<li>The standard SNMP CPU and memory usage statistics (see
<a class="reference external" href="http://net-snmp.sourceforge.net/docs/mibs/ucdavis.html">http://net-snmp.sourceforge.net/docs/mibs/ucdavis.html</a> for details).</li>
<li>The number of Memcached buckets needing to be synchronized and
buckets already resynchronized during the current Astaire
resynchronization operation (overall, and for each peer).</li>
<li>The number of Memcached entries, and amount of data (in bytes)
already resynchronized during the current Astaire resynchronization
operation.</li>
<li>The transfer rate (in bytes/second) of data during this
resynchronization, over the last 5 seconds (overall, and per bucket).</li>
<li>The number of remaining nodes to query during the current Chronos
scaling operation.</li>
<li>The number of timers, and number of invalid timers, processed over
the last 5 seconds.</li>
</ul>
</div>
<div class="section" id="homestead-statistics">
<h3>Homestead Statistics<a class="headerlink" href="#homestead-statistics" title="Permalink to this headline">¶</a></h3>
<p>Homestead nodes provide the following statistics:</p>
<ul class="simple">
<li>The standard SNMP CPU and memory usage statistics (see
<a class="reference external" href="http://net-snmp.sourceforge.net/docs/mibs/ucdavis.html">http://net-snmp.sourceforge.net/docs/mibs/ucdavis.html</a> for details)</li>
<li>The average latency, variance, highest call latency and lowest
latency on HTTP requests, indexed by time period.</li>
<li>The average latency, variance, highest latency and lowest latency on
the Cx interface, indexed by time period.</li>
<li>The average latency, variance, highest latency and lowest latency on
Multimedia-Auth Requests on the Cx interface, indexed by time period.</li>
<li>The average latency, variance, highest latency and lowest latency on
Server-Assignment, User-Authorization and Location-Information
Requests on the Cx interface, indexed by time period.</li>
<li>The number of incoming requests, indexed by time period.</li>
<li>The number of requests rejected due to overload, indexed by time
period.</li>
<li>The total number of Diameter requests with an invalid
Destination-Realm or invalid Destination-Host, indexed by time
period.</li>
<li>The number of Multimedia-Authorization-Answers with a given
result-code received over the Cx interface, indexed by time period.</li>
<li>The number of Server-Assignment-Answers with a given result-code
received over the Cx interface, indexed by time period.</li>
<li>The number of User-Authorization-Answers with a given result-code
received over the Cx interface, indexed by time period.</li>
<li>The number of Location-Information-Answers with a given result-code
received over the Cx interface, indexed by time period.</li>
<li>The number of Push-Profile-Answers with a given result-code sent over
the Cx interface, indexed by time period.</li>
<li>The number of Registration-Termination-Answers with a given
result-code sent over the Cx interface, indexed by time period.</li>
</ul>
</div>
<div class="section" id="call-diversion-app-server-statistics">
<h3>Call Diversion App Server Statistics<a class="headerlink" href="#call-diversion-app-server-statistics" title="Permalink to this headline">¶</a></h3>
<p>Call Diversion App Server nodes provide the following statistics:</p>
<ul class="simple">
<li>The number of attempts, successes and failures for incoming SIP
transactions, indexed by time period and request type.</li>
<li>The number of attempts, successes and failures for outgoing SIP
transactions, indexed by time period and request type.</li>
</ul>
</div>
<div class="section" id="memento-app-server-statistics">
<h3>Memento App Server Statistics<a class="headerlink" href="#memento-app-server-statistics" title="Permalink to this headline">¶</a></h3>
<p>Memento App Server nodes provide the following statistics:</p>
<ul class="simple">
<li>The number of attempts, successes and failures for incoming SIP
transactions, indexed by time period and request type.</li>
<li>The number of attempts, successes and failures for outgoing SIP
transactions, indexed by time period and request type.</li>
</ul>
</div>
<div class="section" id="mmtel-app-server-statistics">
<h3>MMTel App Server Statistics<a class="headerlink" href="#mmtel-app-server-statistics" title="Permalink to this headline">¶</a></h3>
<p>MMTel App Server nodes provide the following statistics:</p>
<ul class="simple">
<li>The number of attempts, successes and failures for incoming SIP
transactions, indexed by time period and request type.</li>
<li>The number of attempts, successes and failures for outgoing SIP
transactions, indexed by time period and request type.</li>
</ul>
</div>
<div class="section" id="gemini-app-server-statistics">
<h3>Gemini App Server Statistics<a class="headerlink" href="#gemini-app-server-statistics" title="Permalink to this headline">¶</a></h3>
<p>Gemini App Server nodes provide the following statistics:</p>
<ul class="simple">
<li>The number of attempts, successes and failures for incoming SIP
transactions, indexed by time period and request type.</li>
<li>The number of attempts, successes and failures for outgoing SIP
transactions, indexed by time period and request type.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">SNMP Statistics</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#bono-statistics">Bono statistics</a></li>
<li><a class="reference internal" href="#sprout-statistics">Sprout statistics</a></li>
<li><a class="reference internal" href="#ralf-statistics">Ralf statistics</a></li>
<li><a class="reference internal" href="#homestead-statistics">Homestead Statistics</a></li>
<li><a class="reference internal" href="#call-diversion-app-server-statistics">Call Diversion App Server Statistics</a></li>
<li><a class="reference internal" href="#memento-app-server-statistics">Memento App Server Statistics</a></li>
<li><a class="reference internal" href="#mmtel-app-server-statistics">MMTel App Server Statistics</a></li>
<li><a class="reference internal" href="#gemini-app-server-statistics">Gemini App Server Statistics</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Voxbone.html" title="previous chapter">Voxbone</a></li>
      <li>Next: <a href="SNMP_Alarms.html" title="next chapter">SNMP Alarms</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Clearwater_SNMP_Statistics.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Metaswitch Networks.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="_sources/Clearwater_SNMP_Statistics.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>